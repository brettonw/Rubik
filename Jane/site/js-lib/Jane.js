"use strict";var Jane=Object.create(null);Jane.events={DATA_POPULATED:"DATA_POPULATED",DATA_FLUSHED:"DATA_FLUSHED",DATA_CHANGED:"DATA_CHANGED"};Jane.formats={EMPTY:"EMPTY",OBJECT:"OBJECT",OBJECT_AS_PROTOTYPE:"OBJECT_AS_PROTOTYPE"};Jane.DataReference=Object.create(null);Jane.DataReference.allowFlushForSubscription=false;Jane.DataReference.Init=function(a){this.subscriptions=[];if("name" in a){this["name"]=a.name}if("allowFlushForSubscription" in a){this["allowFlushForSubscription"]=a.allowFlushForSubscription}return this};Jane.DataReference.CanSubscribe=function(e){if(Object.getOwnPropertyNames(e).length>0){for(var a in e){if(e.hasOwnProperty(a)){for(var b=0,d=this.subscriptions.count;b<d;++b){var c=this.subscriptions[b];if(a in c.contract){return false}}}}if(this.HasData()&&this.chachedData.readOnly){if(this.allowFlushForSubscription){this.Flush()}else{return false}}}return true};Jane.DataReference.Subscribe=function(c,b,a){if(this.CanSubscribe(a)){subscriptions.push({target:c,receiver:b,contract:a});if(self.HasData()){b.apply(c,[Jane.events.DATA_POPULATED,this.cachedData])}return true}return false};Jane.DataReference.SubscribeReadOnly=function(b,a){return this.Subscribe(b,a,{})};Jane.DataReference.Unsubscribe=function(d){for(var a=0,c=this.subscriptions.count;a<c;++a){var b=this.subscriptions[a];if(d==b.target){subscriptions.splice(a,1);return}}};Jane.DataReference.PostEvent=function(d){for(var a=0,c=this.subscriptions.count;a<c;++a){var b=this.subscriptions[a];b.receiver.apply(b.target,[d,this.cachedData])}};Jane.DataReference.HasData=function(){return("cachedData" in this)};Jane.DataReference.GetData=function(){return(this.HasData())?this.cachedData.data:null};Jane.DataReference.GetDataIsReadOnly=function(){if(this.HasData()){return this.cachedData.readOnly}for(var a=0,c=this.subscriptions.count;a<c;++a){var b=this.subscriptions[a];if(Object.getOwnPropertyNames(b.contract).length>0){return false}}return true};Jane.DataReference.GetDataFormat=function(){if(this.HasData()){return this.cachedData.format}return Jane.formats.EMPTY};Jane.DataReference.PopulateDataResponse=function(a,c,b){this.cachedData={data:a,readOnly:c,format:b};this.PostEvent(Jane.events.DATA_POPULATED)};Jane.DataReference.PopulateData=function(){};Jane.DataReference.Populate=function(){if(!this.HasData()){this.PopulateData()}};Jane.DataReference.Flush=function(){if(this.HasData()){delete this.cachedData;this.PostEvent(Jane.events.DATA_FLUSHED)}};Jane.DataReference.Refresh=function(){this.Flush();this.Populate()};Jane.DataReferenceJson=Object.create(Jane.DataReference);Jane.DataReferenceJson.Init=function(a){this.prototype.Init.apply(this,a);if("url" in a){this["url"]=a.url}return this};Jane.DataReferenceJson.PopulateData=function(){$.getJSON(this.url,function(a){this.PopulateDataResponse(a,true,Jane.DataReference.formats.OBJECT)})};Jane.DataReferenceCopy=Object.create(Jane.DataReference);Jane.DataReferenceCopy.filterPlugins={};Jane.DataReferenceCopy.transformPlugins={};Jane.DataReferenceCopy.Init=function(a){this.prototype.Init.apply(this,a);this.filters=[];this.sort=[];this.transform="none";if("source" in a){this["source"]=a.source}this.source.SubscribeReadOnly(this,this.ReceiveEvent);return this};Jane.DataReferenceCopy.FilterRecord=function(a){return true};Jane.DataReferenceCopy.TransformRecord=function(a){return a};Jane.DataReferenceCopy.CopyData=function(e){var d=[];var h=this.GetDataIsReadOnly();var f;if(h){f=e.format;for(var b=0,c=e.data.length;b<c;++b){var a=e.data[b];if(this.FilterRecord(a)){var g=this.TransformRecord(a);d.push(g)}}}else{f=this.formats.OBJECT_AS_PROTOTYPE;for(var b=0,c=e.data.length;b<c;++b){d.push(Object.create(e.data[b]))}}this.PopulateDataResponse({data:d},h,f)};Jane.DataReferenceCopy.ReceiveEvent=function(a,b){switch(a){case Jane.events.DATA_POPULATED:this.CopyData(b);break;default:break}};Jane.DataReferenceCopy.PopulateData=function(){var a=this.source.GetData();if(a!=null){this.CopyData(a)}else{this.source.Populate()}};Jane.DataReferenceCopy.InstallFilterPlugin=function(a){this.filterPlugins[a.name]=a};Jane.DataReferenceCopy.InstallTransformPlugin=function(a){this.transformPlugins[a.name]=a};Jane.DataReferenceCopy.Transform=function(a,b){};