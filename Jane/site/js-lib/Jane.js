"use strict";var Jane=Object.create(null);Jane.events={DATA_POPULATED:"DATA_POPULATED",DATA_FLUSHED:"DATA_FLUSHED",DATA_CHANGED:"DATA_CHANGED"};Jane.formats={EMPTY:"EMPTY",OBJECT:"OBJECT",OBJECT_AS_PROTOTYPE:"OBJECT_AS_PROTOTYPE"};Jane.DataReference=Object.create(null);Jane.DataReference.allowFlushForSubscription=false;Jane.DataReference.Init=function(a){this.subscriptions=[];if("name" in a){this["name"]=a.name}if("allowFlushForSubscription" in a){this["allowFlushForSubscription"]=a.allowFlushForSubscription}return this};Jane.DataReference.CanSubscribe=function(e){if(Object.getOwnPropertyNames(e).length>0){for(var a in e){if(e.hasOwnProperty(a)){for(var b=0,d=this.subscriptions.length;b<d;++b){var c=this.subscriptions[b];if(a in c.contract){return false}}}}if(this.HasData()&&this.chachedData.readOnly){if(this.allowFlushForSubscription){this.Flush()}else{return false}}}return true};Jane.DataReference.Subscribe=function(f,e,d){if(this.CanSubscribe(d)){for(var a=0,c=this.subscriptions.length;a<c;++a){var b=this.subscriptions[a];if(f==b.target){return false}}this.subscriptions.push({target:f,receiver:e,contract:d});if(this.HasData()){e.apply(f,[Jane.events.DATA_POPULATED,this.cachedData])}return true}return false};Jane.DataReference.SubscribeReadOnly=function(b,a){return this.Subscribe(b,a,{})};Jane.DataReference.Unsubscribe=function(d){for(var a=0,c=this.subscriptions.length;a<c;++a){var b=this.subscriptions[a];if(d==b.target){this.subscriptions.splice(a,1);return}}};Jane.DataReference.PostEvent=function(d){for(var a=0,c=this.subscriptions.length;a<c;++a){var b=this.subscriptions[a];b.receiver.apply(b.target,[this,d])}};Jane.DataReference.HasData=function(){return("cachedData" in this)};Jane.DataReference.GetData=function(){return(this.HasData())?this.cachedData.data:null};Jane.DataReference.GetDataIsReadOnly=function(){if(this.HasData()){return this.cachedData.readOnly}for(var a=0,c=this.subscriptions.length;a<c;++a){var b=this.subscriptions[a];if(Object.getOwnPropertyNames(b.contract).length>0){return false}}return true};Jane.DataReference.GetDataFormat=function(){if(this.HasData()){return this.cachedData.format}return Jane.formats.EMPTY};Jane.DataReference.PopulateDataResponse=function(b,d,c,a){this.cachedData={data:b,readOnly:d,format:c};this.PostEvent(a)};Jane.DataReference.PopulateData=function(){};Jane.DataReference.Populate=function(){if(!this.HasData()){this.PopulateData()}};Jane.DataReference.Flush=function(){if(this.HasData()){delete this.cachedData;this.PostEvent(Jane.events.DATA_FLUSHED)}};Jane.DataReference.Refresh=function(){this.Flush();this.Populate()};Jane.DataReferenceJson=Object.create(Jane.DataReference);Jane.DataReferenceJson.Init=function(a){(Object.getPrototypeOf((Object.getPrototypeOf(this)))).Init.call(this,a);if("url" in a){this["url"]=a.url}return this};Jane.DataReferenceJson.PopulateData=function(){var a=this;$.getJSON(this.url,function(b){a.PopulateDataResponse(b,true,Jane.formats.OBJECT,Jane.events.DATA_POPULATED)})};Jane.DataReferenceCopy=Object.create(Jane.DataReference);Jane.DataReferenceCopy.Init=function(a){(Object.getPrototypeOf((Object.getPrototypeOf(this)))).Init.call(this,a);this.filter=null;this.select=null;this.transform=null;this.sort=null;if("source" in a){this["source"]=a.source}this.source.SubscribeReadOnly(this,this.ReceiveEvent);return this};Jane.DataReferenceCopy.CopyData=function(k,a){var c=k.data;var n=this.GetDataFormat();var m=this.GetDataIsReadOnly();var r=[];for(var d=0,g=c.length;d<g;++d){var f=c[d];if((this.filter===null)||(this.filter.HandleRecord(f))){if(this.select===null){if(!m){f=Object.create(f);n=Jane.formats.OBJECT_AS_PROTOTYPE}}else{var h={};for(var b=0,l=this.select.length;b<l;++b){var o=this.select[b];h[o]=f[o]}f=h;n=Jane.formats.OBJECT}if(this.transform!==null){f=this.transform.HandleRecord(f)}r.push(f)}}if(this.sort!==null){var p=this;var e=this.sort.length;var q=function(s,j){var x=function(A,y,D,E){switch(D){case"Number":case"String":var z=Number(A);var i=Number(y);if((z==A.toString())&&(i==y.toString())){return E?(z-i):(i-z)}return E?A.localeCompare(y):y.localeCompare(A);break;case"Date":var C=new Date(A).valueOf();var B=new Date(y).valueOf();return E?(C-B):(B-C);break}return 0};for(var v=0,w=p.sort.length;v<w;++v){var t=p.sort[v];var u=x(s[t.name],j[t.name],t.type,t.asc);if(u!=0){return u}}return 0};r.sort(q)}this.PopulateDataResponse({data:r},m,n,a)};Jane.DataReferenceCopy.ReceiveEvent=function(a,b){switch(b){case Jane.events.DATA_POPULATED:if("populateRequested" in this){delete this.populateRequested;this.CopyData(a.GetData(),b)}break;case Jane.events.DATA_CHANGED:if(this.HasData()){this.CopyData(a.GetData(),b)}break;case Jane.events.DATA_FLUSHED:if(this.HasData()){this.Flush()}break;default:break}};Jane.DataReferenceCopy.PopulateData=function(){var a=this.source.GetData();if(a!=null){this.CopyData(a,Jane.events.DATA_POPULATED)}else{this.populateRequested=true;this.source.Populate()}};