<!doctype html> 
<html>
<head>
    <title>Symbolic Math - Test Page</title>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="SymbolicMath.js"></script>
</head>
<body onload="initPage();">
<div id="display">display</div>
<script type="text/javascript">

    var values = { x: 4.0 };
    var display = new String();

    function Round(value, significance)
    {
        var multiplier = Math.pow (10, significance);
        var scaledValue = value * multiplier;
        scaledValue = Math.floor (scaledValue);
        return (scaledValue / multiplier).toString ();
        //return value.toString ();
    }
    
    function Test(name, equation, expected)
    {
        var result = Round (equation.N (values), 6);
        var expect = Round (expected, 6);
        var test = (result == expect);
        display += "<tr><td>" + name + "</td><td>" + equation.toString () + "</td><td>=</td><td align='right'>" + result + "</td><td align='right'>" + expect + "</td><td>" + (test ? "<div style='color: white;background-color: green'>PASS</div>" : "<div style='color: white;background-color: red'>FAIL</div>") + "</td></tr>\n";
        document.getElementById("display") .innerHTML = display + "</table></br>\n";
        return test;
    }

    function initPage()
    {
        display = "Test Results: <br>\n<table cellspacing='5'>";
        display += "<tr><th>Name</th><th>Equation</th><th></th><th>Result</th><th>Expect</th><th>Test</th></tr>\n";

        var pass = true;

        // test addition
        if (pass)
        {
            var equation = SM.Add (3.5, "x");
            equation.Simplify ();
            pass &= Test ("Addition", equation, 3.5 + values.x);
        }

        // test subtraction
        if (pass)
        {
            var equation = SM.Subtract (3.5, "x");
            pass &= Test ("Subtraction", equation, 3.5 - values.x);
        }

        // test multiplication
        if (pass)
        {
            var equation = SM.Multiply (3.5, "x");
            pass &= Test ("Multiplication", equation, 3.5 * values.x);
        }

        // test division
        if (pass)
        {
            var equation = SM.Divide (3.5, "x");
            pass &= Test ("Division", equation, 3.5 / values.x);
        }

        // test power
        if (pass)
        {
            var equation = SM.Power (3.5, "x");
            pass &= Test ("Power", equation, Math.pow (3.5, values.x));
        }

        // test chaining
        if (pass)
        {
            var equation = SM.Add (3.5, "x").Multiply (3.5).Subtract (2.0).Divide (2.0);
            pass &= Test ("Chaining", equation, (((3.5 + values.x) * 3.5) + (-1 * 2)) / 2);
        }

        // test something more complicated
        if (pass)
        {
            var equation = SM.Divide (SM.Multiply (3.5, SM.Add (3.5, 5.1).Add(SM.Power ("x", 3.5))), 2.0);
            pass &= Test ("Complicated", equation, (3.5 * (3.5 + 5.1 + Math.pow (values.x, 3.5))) / 2.0);
        }

        // test simplification
        if (pass)
        {
            var equation = SM.Add (2.0, 3.5, "x").Add (0).Simplify ();
            pass &= Test ("Simplify +", equation, 2.0 + 3.5 + values.x + 0);
        }

        if (pass)
        {
            var equation = SM.Multiply (2.0, 3.5, "x").Simplify ();
            pass &= Test ("Simplify *", equation, 2.0 * 3.5 * values.x);
        }

        if (pass)
        {
            var equation = SM.Multiply (2.0, 3.5, "x").Multiply (0).Simplify ();
            pass &= Test ("Simplify * 2", equation, 2.0 * 3.5 * values.x * 0);
        }

        if (pass)
        {
            var equation = SM.Expr ("x").Power (2.0).Multiply (5.0).Divide (3.0).Simplify ();
            pass &= Test ("Simplify Complicated", equation, Math.pow (values.x, 2.0) * 5.0 / 3.0);
        }

        if (pass)
        {
            var equation = SM.Add (3.5, "x").Multiply (3.5).Subtract (2.0).Divide (2.0).Simplify ();
            pass &= Test ("Chaining", equation, (((3.5 + values.x) * 3.5) + (-1 * 2)) / 2);
        }

        if (pass)
        {
            var equation = SM.Add ("x").Add ("x").Add ("x").Add ("x").Add ("x").Add (SM.Multiply ("x", "x")).Add (SM.Multiply ("x", "x")).Simplify ();
            pass &= Test ("Simplify multiple terms", equation, (values.x * 5.0) + (values.x * values.x * 2.0));
        }

        if (pass)
        {
            var equation = SM.Divide (SM.Multiply (3.5, SM.Add (3.5, 5.1).Add(SM.Power ("x", 3.5))), 2.0).Simplify ();
            pass &= Test ("Complicated", equation, (3.5 * (3.5 + 5.1 + Math.pow (values.x, 3.5))) / 2.0);
        }
        
        // test derivatives
        if (pass)
        {
            var equation = SM.Expr ("x").Power (2.0).Multiply (5.0);
            var before = equation.toString ();
            //console.log ("before=" + before);
            var derivative = equation.D(values);
            var after = equation.toString ();
            //console.log ("after=" + after);
            if (before == after) {
                pass &= Test ("Derivative", derivative, values.x * 5.0 * 2.0);
            }
        }

        if (pass)
        {
            var equation = SM.Expr ("x").Power (2.0).Multiply (5.0).Divide (3.0);
            var before = equation.toString ();
            //console.log ("before=" + before);
            var derivative = equation.D(values);
            var after = equation.toString ();
            //console.log ("after=" + after);
            if (before == after) {
                pass &= Test ("Derivative", derivative, values.x * 5.0 * 2.0 / 3.0);
            }
        }

    }
</script>
</body>
</html>