"use strict";var Vector2d=Object.create(null);Vector2d.Create=function(b){return{x:b[0],y:b[1]}};Vector2d.XY=function(a,b){return{x:a,y:b}};Vector2d.Zero=function(){return{x:0,y:0}};Vector2d.One=function(){return{x:1,y:1}};Vector2d.Add=function(d,c){return this.Create(d.x+c.x,d.y+c.y)};Vector2d.Subtract=function(d,c){return this.Create(d.x-c.x,d.y-c.y)};Vector2d.Scale=function(d,c){return this.Create(d.x*c,d.y*c)};Vector2d.Dot=function(d,c){return(d.x*c.x)+(d.y*c.y)};Vector2d.Cross=function(d,c){return(d.x*c.y)-(d.y*c.x)};Vector2d.NormSq=function(b){return this.Dot(b,b)};Vector2d.Norm=function(b){return Math.sqrt(this.NormSq(b))};var Thing=Object.create(null);Thing.oneOverMoment=0;Thing.spinPosition=0;Thing.spinVelocity=0;Thing.torque=0;Thing.oneOverMass=0;Thing.position=Vector2d.Zero();Thing.velocity=Vector2d.Zero();Thing.force=Vector2d.Zero();Thing.mediumDensity=-0.05;Thing.integrate=function(a){this.force=Vector2d.Add(this.force,Vector2d.Scale(this.velocity,this.mediumDensity));this.torque=this.torque+(this.spinVelocity*this.viscosity);var d=Vector2d.Scale(this.force,(this.oneOverMass*a));this.force=Vector2d.Zero();var b=this.torque*this.oneOverMoment*a;this.torque=0;this.position=Vector2d.Add(this.position,Vector2d.Scale(Vector2d.Add(Vector2d.Scale(d,0.5),this.velocity),a));this.spinPosition=this.spinPosition+(((b*0.5)+this.spinVelocity)*a);this.velocity=Vector2d.Add(this.velocity,d);this.spinVelocity=this.spinVelocity+b;var c=MATH.PI*2;while(this.spinPosition>=c){this.spinPosition-=c}while(this.spinPosition<0){this.spinPosition+=c}};Thing.applyForce=function(a){this.force=a};thing.applyTorque=function(a){this.torque=a};Thing.makeBallGeometry=function(a){var b=Math.PI*a*a;var c=(b*a*a)/2;this.oneOverMass=1/b;this.oneOverMoment=1/c;this.svg=container.append("circle").attr("stroke-width",2/scale).attr("fill","red").attr("fill-opacity","1.0").attr("stroke","black").attr("stroke-opacity","1.0").attr("r",a)};Thing.makePolygonGeometry=function(c){var c=[Vector2d.XY(0,0),Vector2d.XY(-0.05,0.05),Vector2d.XY(0.1,0),Vector2d.XY(-0.05,-0.05)];var b=c[0].x+","+c[0].y;for(var a=1;a<c.length;++a){b+=" "+c[a].x+","+c[a].y}this.svg=container.append("polygon").attr("stroke-width",2/scale).attr("fill","red").attr("fill-opacity","1.0").attr("stroke","black").attr("stroke-opacity","1.0").attr("stroke-linejoin","round").attr("points",b)};Thing.update=function(a){this.position=Vector2d.XY(this.position.x+(this.velocity.x*a),this.position.y+(this.velocity.y*a));this.svg.attr("transform","translate("+this.position.x+","+this.position.y+") rotate("+this.orientation+", 0.0, 0.0)")};var Ship=Object.create(Thing);Ship.engines=Vector2d.Zero();Ship.update=function(a){var c=(this.orientation*Math.PI)/180;var b=0.01;this.velocity=Vector2d.XY(this.velocity.x+(Math.cos(c)*b*a),this.velocity.y+(Math.sin(c)*b*a));this.orientation+=1;Object.getPrototypeOf(Ship).update.call(this,a)};var scale=1;function initPage(){var m=d3.select("#display");var h=m.append("svg").attr("class","gameDisplay");h.style("opacity",0.000001).transition().duration(1000).style("opacity",1);h.append("rect").attr("class","gameBackground").attr("width","100%").attr("height","100%");var a=h.append("g").attr("class","gameDisplay");h.call(d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([0.125,8]).on("zoom",function(){a.attr("transform","translate("+d3.event.translate[0]+","+d3.event.translate[1]+") scale("+d3.event.scale+")")}));h=a.append("g").attr("class","gameDisplay");var o=m[0][0].clientWidth;var b=m[0][0].clientHeight;scale=Math.min(o,b);h.attr("transform","translate("+(o/2)+","+(b/2)+") scale("+scale+","+-scale+")");h=h.append("g").attr("class","gameDisplay");var g=[0];var c;var j;for(var f=1;f<25;++f){var n=0.05*f;c=-n;j=n;g=[c].concat(g).concat([j])}h.selectAll(".xTicks").data(g).enter().append("line").attr("class","xTicks").attr("x1",function(i){return i}).attr("y1",c).attr("x2",function(i){return i}).attr("y2",j).attr("stroke","rgba(0, 0, 0, 0.20)").attr("stroke-width",1/scale);h.selectAll(".yTicks").data(g).enter().append("line").attr("class","yTicks").attr("x1",c).attr("y1",function(i){return i}).attr("x2",j).attr("y2",function(i){return i}).attr("stroke","rgba(0, 0, 0, 0.20)").attr("stroke-width",1/scale);var d=Object.create(Ship);d.makePolygonGeometry(h);var k=Object.create(Ship);k.makeBallGeometry(h);k.position=Vector2d.XY(-0.5,-0.5);var l=1/20;var e=setInterval(function(){d.update(l);k.update(l)},1000*l)};